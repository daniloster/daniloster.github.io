(window.webpackJsonp=window.webpackJsonp||[]).push([[4,12,13],{B9Oc:function(e,t,n){"use strict";n.r(t);var a=n("vOnD");t.default=a.a.li.withConfig({displayName:"Item",componentId:"ar5lpr-0"})([""])},iOt1:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return C}));var a=n("q1tI"),l=n.n(a),o=n("vOnD"),r=n("G2tH"),i=n("ebhC"),c=n("/Bgi"),s=n("oqi6"),d=n("uzDE"),u=n("DR7b"),m=n("eATi"),p=n("iook"),h=n("B9Oc"),f="prism",v=o.a.button.attrs({type:"button"}).withConfig({displayName:"ClickOutHandler__Button",componentId:"sc-61ss07-0"})(["background-color:blue;color:white;"]),E=o.a.div.withConfig({displayName:"ClickOutHandler__DropdownContainer",componentId:"sc-61ss07-1"})(["position:relative;"]),g=o.a.div.withConfig({displayName:"ClickOutHandler__DropdownPanel",componentId:"sc-61ss07-2"})(["background-color:red;color:white;position:absolute;top:100%;z-index:1;padding:10px;"]),b=function(e){var t=e.children,n=e.name,a=e.items,o=e.isCorrect,r=void 0!==o&&o,i=l.a.useState(!1),c=i[0],s=i[1],d=l.a.useRef(null);return l.a.useEffect((function(){var e=function(e){!d.current||d.current.contains(e.target)||r&&!document.body.contains(e.target)||(console.log("Click out event from container:",n),s(!1))};return document.addEventListener("click",e),function(){document.removeEventListener("click",e)}}),[]),l.a.createElement(E,{ref:d},l.a.createElement(v,{onClick:function(){return s(!0)}},n),c&&l.a.createElement(g,null,t||a.map((function(e){return l.a.createElement(v,{key:e.name,type:"button",onClick:function(){console.log('Clicking from container "'+n+'" on item:',e.name),s(!1)}},e.name)}))))},w=[{name:"Brazil"},{name:"Ireland"}],k=function(e){var t=e.complement,n=e.isCorrect;return l.a.createElement(b,{isCorrect:n,name:t+" Locale",items:w})},y=function(e){var t=e.isCorrect;return l.a.createElement(b,{isCorrect:t,name:"Profile"},l.a.createElement(k,{isCorrect:t,complement:"Primary"}),l.a.createElement(k,{isCorrect:t,complement:"Secondary"}))};function C(e){var t=e.html,n=l.a.useRef(0),a=l.a.useRef(null);return l.a.useEffect((function(){var e=function(e){n.current+=1,console.log("[Click count:",n.current,"]: You have clicked on the element:",e.target)},t=function(e){console.log("Mouse click event for:",e.currentTarget)};return a.current.addEventListener("click",t),document.addEventListener("click",e),function(){a.current.removeEventListener("click",t),document.removeEventListener("click",e)}}),[]),l.a.createElement("div",null,l.a.createElement(u.default,null,t),l.a.createElement(r.default,null,"Before we go straight to the point (Click Outside Events), let's exercise and strengthen some important base knowledge."),l.a.createElement(r.default,null,"Along the past few years, browsers unified the way the DOM (Document Object Model) is treated. Thus, there is a common way to add or remove event handlers,"," ",l.a.createElement(s.default,{href:"https://caniuse.com/#feat=addeventlistener",target:"_blank"},"see reference"),"."),l.a.createElement(r.default,null,"Currently, most of the browsers have support to"," ",l.a.createElement(s.default,{href:"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener",target:"_blank"},"addEventListener")," ","and"," ",l.a.createElement(s.default,{href:"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener",target:"_blank"},"removeEventListener"),". Their API spec accepts an event name, function handler and options which contains a few properties."),l.a.createElement(i.default,null,"Events"),l.a.createElement(r.default,null,"An event can be either added to an element or to the document. For a better learning experience through this post, keep the console open. The events presented are added to this page. See the example below."),l.a.createElement(d.default,{theme:f,code:'\nlet eventCount = 0;\n\ndocument.addEventListener(\'click\', (e) => {\n  eventCount += 1;\n  console.log(\n    "[Click count:",\n    eventCount,\n    "]: You have clicked on the element:",\n    e.target\n  );\n});\n          '.trim()}),l.a.createElement(r.default,null,"So, every click on the document will log the element clicked."),l.a.createElement(r.default,null,"Almost all events bubble up through its containers until reach the document. The only exception is the ",l.a.createElement("i",null,"focus")," event."),l.a.createElement(r.default,null,l.a.createElement(m.default,{name:"EventBubbling"})),l.a.createElement(r.default,null,"There are at least 2 ways to prevent the events to bubble up."),l.a.createElement(p.default,null,l.a.createElement(h.default,null,"Dispatching event indicating to not bubble it."),l.a.createElement(h.default,null,"Using ",l.a.createElement("i",null,"e.stopImmediatePropagation()")," in one of the handlers")),l.a.createElement(r.default,null,l.a.createElement(s.default,{ref:a,onMouseEnter:function(e){console.log("Mouse enter event for:",e.currentTarget);var t=new MouseEvent("click",{bubbles:!1});e.currentTarget.dispatchEvent(t)}},"Hover me to dispatch")," ","the event below."),l.a.createElement(d.default,{theme:f,code:'\nconst evt = new MouseEvent("click", { bubbles: false });\ne.currentTarget.dispatchEvent(evt);\n          '.trim()}),l.a.createElement(r.default,null,l.a.createElement(s.default,{onClick:function(e){e.nativeEvent.stopImmediatePropagation(),console.log("Stopped propagation at:",e.currentTarget)}},"Click me to dispatch")," ","the event below."),l.a.createElement(d.default,{theme:f,code:"\nelement.addEventListener('click', e => {\n  e.stopImmediatePropagation();\n  console.log(\"Stopped propagation at:\", e.currentTarget);\n})\n          ".trim()}),l.a.createElement(r.default,null,"Ok, so far we have been playing with events and I hope it gave to you a sense of how they work."),l.a.createElement(i.default,null,"ClickOut Event"),l.a.createElement(r.default,null,"Browsers do not have click out event out of the box. We need to implement them. The are basically listeners added to the document on click event."),l.a.createElement(r.default,null,"Most of the examples that I have come across are implemented as simple as it can be, also, they have a bug."),l.a.createElement(r.default,null,"Let's assume we have a dropdown panel which is open when user clicks on a button and it is closed when user clicks outside."),l.a.createElement(r.default,null,"The basic idea of click out is usually implemented as below."),l.a.createElement(d.default,{theme:f,code:"\ndocument.addEventListener('click', e => {\n  const dropdownPanel = document.querySelector('.dropdown-panel.is-open');\n  if (dropdownPanel && !dropdownPanel.contains(e.target)) {\n    // we remove the is-open class\n    dropdownPanel.setAttribute('class', 'dropdown-panel');\n  }\n})\n          ".trim()}),l.a.createElement(r.default,null,"Then, what is the problem with this? To get a crystal clear idea about the problem, we need to create a bit more complex scenario. So, let's imagine we have the same dropdown panel as a profile dropdown which allows users to select locales from a nested dropdown."),l.a.createElement(r.default,null,"Now we have a dropdown panel inside another dropdown panel. See the example below for a better view of the problem."),l.a.createElement(r.default,null,"Example 1: ",l.a.createElement(y,null)),l.a.createElement(r.default,null,'Open the "Profile" dropdown, also the "Primary Locale" dropdown. Then, select one of the items for locale.'),l.a.createElement(r.default,null,'You will notice that all panel have been dismissed. This is because the events bubble up and when it reaches the profile container "clickout" handler, the nested panel is already dismissed as selection has already happened. At this point, for the "Profile" dropdown element is not contained in the "Profile" container. This is half-true. It is not there, but it was.'),l.a.createElement(r.default,null,"Fixing it is a matter of checking if the element is still present in the full dom. See below the third expression in the if"," ",l.a.createElement("i",null,"document.body.contains(e.target)"),"."),l.a.createElement(d.default,{theme:f,code:"\ndocument.addEventListener('click', e => {\n  const dropdownPanel = document.querySelector('.dropdown-panel.is-open');\n  /**\n   * We just dismiss the panel if the target element does not belong to the\n   * container, but, it is still present in the DOM.\n   */\n  if (\n    dropdownPanel &&\n    !dropdownPanel.contains(e.target) &&\n    document.body.contains(e.target)\n  ) {\n    // we remove the is-open class\n    dropdownPanel.setAttribute('class', 'dropdown-panel');\n  }\n})\n          ".trim()}),l.a.createElement(r.default,null,"Example 2: ",l.a.createElement(y,{isCorrect:!0})),l.a.createElement(c.default,null,l.a.createElement(s.default,{href:"https://javascript.info/bubbling-and-capturing",target:"_blank"},"Bubbling and capturing"),l.a.createElement(s.default,{href:"https://caniuse.com/#feat=addeventlistener",target:"_blank"},"caniuse.com - addEventListener"),l.a.createElement(s.default,{href:"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener",target:"_blank"},"MDN - addEventListener"),l.a.createElement(s.default,{href:"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent",target:"_blank"},"MDN - dispatchEvent"),l.a.createElement(s.default,{href:"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener",target:"_blank"},"MDN - removeEventListener"),l.a.createElement(s.default,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Event/stopImmediatePropagation",target:"_blank"},"MDN - stopImmediatePropagation")))}},iook:function(e,t,n){"use strict";n.r(t);var a=n("vOnD");t.default=a.a.ul.withConfig({displayName:"List",componentId:"sc-1o1ju7h-0"})(["padding:10px;"])}}]);
//# sourceMappingURL=4-43d2d7f1af406959ed35.js.map