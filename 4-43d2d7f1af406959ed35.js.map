{"version":3,"sources":["webpack:///./src/templates/components/Item.js","webpack:///./src/articles/ClickOutHandler.js","webpack:///./src/templates/components/List.js"],"names":["styled","li","codeTheme","Button","button","attrs","type","DropdownContainer","div","DropdownPanel","Dropdown","children","name","items","isCorrect","React","useState","isOpen","setIsOpen","containerRef","useRef","useEffect","handler","e","current","contains","target","document","body","console","log","addEventListener","removeEventListener","ref","onClick","map","item","key","localeItems","Locales","complement","Profile","Article","brief","html","countRef","linkDispatchNoBubblingRef","linkDispatchNoBubblingHandler","currentTarget","href","theme","code","trim","onMouseEnter","evt","MouseEvent","bubbles","dispatchEvent","nativeEvent","stopImmediatePropagation","ul"],"mappings":"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","file":"4-43d2d7f1af406959ed35.js","sourcesContent":["import styled from \"styled-components\"\n\nexport default styled.li``\n","import React from \"react\"\nimport styled from \"styled-components\"\nimport Paragraph from \"../templates/components/Paragraph\"\nimport Subtitle from \"../templates/components/Subtitle\"\nimport References from \"../templates/components/References\"\nimport A from \"../templates/components/A\"\nimport Code from \"../templates/components/Code\"\nimport Html from \"../templates/components/Html\"\nimport Img from \"../templates/components/Img\"\nimport List from \"../templates/components/List\"\nimport Item from \"../templates/components/Item\"\n\nconst codeTheme = \"prism\"\n\nconst Button = styled.button.attrs({ type: \"button\" })`\n  background-color: blue;\n  color: white;\n`\n\nconst DropdownContainer = styled.div`\n  position: relative;\n`\n\nconst DropdownPanel = styled.div`\n  background-color: red;\n  color: white;\n  position: absolute;\n  top: 100%;\n  z-index: 1;\n  padding: 10px;\n`\n\nconst Dropdown = ({ children, name, items, isCorrect = false }) => {\n  const [isOpen, setIsOpen] = React.useState(false)\n  const containerRef = React.useRef(null)\n  React.useEffect(() => {\n    const handler = e => {\n      if (\n        containerRef.current &&\n        !containerRef.current.contains(e.target) &&\n        (!isCorrect || document.body.contains(e.target))\n      ) {\n        console.log(\"Click out event from container:\", name)\n        setIsOpen(false)\n      }\n    }\n\n    document.addEventListener(\"click\", handler)\n    return () => {\n      document.removeEventListener(\"click\", handler)\n    }\n  }, [])\n\n  return (\n    <DropdownContainer ref={containerRef}>\n      <Button onClick={() => setIsOpen(true)}>{name}</Button>\n      {isOpen && (\n        <DropdownPanel>\n          {children ||\n            items.map(item => (\n              <Button\n                key={item.name}\n                type=\"button\"\n                onClick={() => {\n                  console.log(\n                    `Clicking from container \"${name}\" on item:`,\n                    item.name\n                  )\n                  setIsOpen(false)\n                }}\n              >\n                {item.name}\n              </Button>\n            ))}\n        </DropdownPanel>\n      )}\n    </DropdownContainer>\n  )\n}\n\nconst localeItems = [{ name: \"Brazil\" }, { name: \"Ireland\" }]\nconst Locales = ({ complement, isCorrect }) => {\n  return (\n    <Dropdown\n      isCorrect={isCorrect}\n      name={`${complement} Locale`}\n      items={localeItems}\n    />\n  )\n}\nconst Profile = ({ isCorrect }) => {\n  return (\n    <Dropdown isCorrect={isCorrect} name=\"Profile\">\n      <Locales isCorrect={isCorrect} complement=\"Primary\" />\n      <Locales isCorrect={isCorrect} complement=\"Secondary\" />\n    </Dropdown>\n  )\n}\n\nexport default function Article({ html: brief }) {\n  const countRef = React.useRef(0)\n  const linkDispatchNoBubblingRef = React.useRef(null)\n  React.useEffect(() => {\n    const handler = e => {\n      countRef.current += 1\n      console.log(\n        \"[Click count:\",\n        countRef.current,\n        \"]: You have clicked on the element:\",\n        e.target\n      )\n    }\n\n    const linkDispatchNoBubblingHandler = e => {\n      console.log(\"Mouse click event for:\", e.currentTarget)\n    }\n    linkDispatchNoBubblingRef.current.addEventListener(\n      \"click\",\n      linkDispatchNoBubblingHandler\n    )\n\n    document.addEventListener(\"click\", handler)\n\n    return () => {\n      linkDispatchNoBubblingRef.current.removeEventListener(\n        \"click\",\n        linkDispatchNoBubblingHandler\n      )\n      document.removeEventListener(\"click\", handler)\n    }\n  }, [])\n  return (\n    <div>\n      <Html>{brief}</Html>\n      <Paragraph>\n        Before we go straight to the point (Click Outside Events), let's\n        exercise and strengthen some important base knowledge.\n      </Paragraph>\n      <Paragraph>\n        Along the past few years, browsers unified the way the DOM (Document\n        Object Model) is treated. Thus, there is a common way to add or remove\n        event handlers,{\" \"}\n        <A href=\"https://caniuse.com/#feat=addeventlistener\" target=\"_blank\">\n          see reference\n        </A>\n        .\n      </Paragraph>\n      <Paragraph>\n        Currently, most of the browsers have support to{\" \"}\n        <A\n          href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\"\n          target=\"_blank\"\n        >\n          addEventListener\n        </A>{\" \"}\n        and{\" \"}\n        <A\n          href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener\"\n          target=\"_blank\"\n        >\n          removeEventListener\n        </A>\n        . Their API spec accepts an event name, function handler and options\n        which contains a few properties.\n      </Paragraph>\n      <Subtitle>Events</Subtitle>\n      <Paragraph>\n        An event can be either added to an element or to the document. For a\n        better learning experience through this post, keep the console open. The\n        events presented are added to this page. See the example below.\n      </Paragraph>\n      <Code\n        theme={codeTheme}\n        code={`\nlet eventCount = 0;\n\ndocument.addEventListener('click', (e) => {\n  eventCount += 1;\n  console.log(\n    \"[Click count:\",\n    eventCount,\n    \"]: You have clicked on the element:\",\n    e.target\n  );\n});\n          `.trim()}\n      />\n      <Paragraph>\n        So, every click on the document will log the element clicked.\n      </Paragraph>\n      <Paragraph>\n        Almost all events bubble up through its containers until reach the\n        document. The only exception is the <i>focus</i> event.\n      </Paragraph>\n      <Paragraph>\n        <Img name=\"EventBubbling\" />\n      </Paragraph>\n      <Paragraph>\n        There are at least 2 ways to prevent the events to bubble up.\n      </Paragraph>\n      <List>\n        <Item>Dispatching event indicating to not bubble it.</Item>\n        <Item>\n          Using <i>e.stopImmediatePropagation()</i> in one of the handlers\n        </Item>\n      </List>\n      <Paragraph>\n        <A\n          ref={linkDispatchNoBubblingRef}\n          onMouseEnter={e => {\n            console.log(\"Mouse enter event for:\", e.currentTarget)\n            const evt = new MouseEvent(\"click\", {\n              bubbles: false,\n            })\n            e.currentTarget.dispatchEvent(evt)\n          }}\n        >\n          Hover me to dispatch\n        </A>{\" \"}\n        the event below.\n      </Paragraph>\n      <Code\n        theme={codeTheme}\n        code={`\nconst evt = new MouseEvent(\"click\", { bubbles: false });\ne.currentTarget.dispatchEvent(evt);\n          `.trim()}\n      />\n      <Paragraph>\n        <A\n          onClick={e => {\n            e.nativeEvent.stopImmediatePropagation()\n            console.log(\"Stopped propagation at:\", e.currentTarget)\n          }}\n        >\n          Click me to dispatch\n        </A>{\" \"}\n        the event below.\n      </Paragraph>\n      <Code\n        theme={codeTheme}\n        code={`\nelement.addEventListener('click', e => {\n  e.stopImmediatePropagation();\n  console.log(\"Stopped propagation at:\", e.currentTarget);\n})\n          `.trim()}\n      />\n      <Paragraph>\n        Ok, so far we have been playing with events and I hope it gave to you a\n        sense of how they work.\n      </Paragraph>\n      <Subtitle>ClickOut Event</Subtitle>\n      <Paragraph>\n        Browsers do not have click out event out of the box. We need to\n        implement them. The are basically listeners added to the document on\n        click event.\n      </Paragraph>\n      <Paragraph>\n        Most of the examples that I have come across are implemented as simple\n        as it can be, also, they have a bug.\n      </Paragraph>\n      <Paragraph>\n        Let's assume we have a dropdown panel which is open when user clicks on\n        a button and it is closed when user clicks outside.\n      </Paragraph>\n      <Paragraph>\n        The basic idea of click out is usually implemented as below.\n      </Paragraph>\n      <Code\n        theme={codeTheme}\n        code={`\ndocument.addEventListener('click', e => {\n  const dropdownPanel = document.querySelector('.dropdown-panel.is-open');\n  if (dropdownPanel && !dropdownPanel.contains(e.target)) {\n    // we remove the is-open class\n    dropdownPanel.setAttribute('class', 'dropdown-panel');\n  }\n})\n          `.trim()}\n      />\n      <Paragraph>\n        Then, what is the problem with this? To get a crystal clear idea about\n        the problem, we need to create a bit more complex scenario. So, let's\n        imagine we have the same dropdown panel as a profile dropdown which\n        allows users to select locales from a nested dropdown.\n      </Paragraph>\n      <Paragraph>\n        Now we have a dropdown panel inside another dropdown panel. See the\n        example below for a better view of the problem.\n      </Paragraph>\n      <Paragraph>\n        Example 1: <Profile />\n      </Paragraph>\n      <Paragraph>\n        Open the \"Profile\" dropdown, also the \"Primary Locale\" dropdown. Then,\n        select one of the items for locale.\n      </Paragraph>\n      <Paragraph>\n        You will notice that all panel have been dismissed. This is because the\n        events bubble up and when it reaches the profile container \"clickout\"\n        handler, the nested panel is already dismissed as selection has already\n        happened. At this point, for the \"Profile\" dropdown element is not\n        contained in the \"Profile\" container. This is half-true. It is not\n        there, but it was.\n      </Paragraph>\n      <Paragraph>\n        Fixing it is a matter of checking if the element is still present in the\n        full dom. See below the third expression in the if{\" \"}\n        <i>document.body.contains(e.target)</i>.\n      </Paragraph>\n      <Code\n        theme={codeTheme}\n        code={`\ndocument.addEventListener('click', e => {\n  const dropdownPanel = document.querySelector('.dropdown-panel.is-open');\n  /**\n   * We just dismiss the panel if the target element does not belong to the\n   * container, but, it is still present in the DOM.\n   */\n  if (\n    dropdownPanel &&\n    !dropdownPanel.contains(e.target) &&\n    document.body.contains(e.target)\n  ) {\n    // we remove the is-open class\n    dropdownPanel.setAttribute('class', 'dropdown-panel');\n  }\n})\n          `.trim()}\n      />\n      <Paragraph>\n        Example 2: <Profile isCorrect />\n      </Paragraph>\n      <References>\n        <A\n          href=\"https://javascript.info/bubbling-and-capturing\"\n          target=\"_blank\"\n        >\n          Bubbling and capturing\n        </A>\n        <A href=\"https://caniuse.com/#feat=addeventlistener\" target=\"_blank\">\n          caniuse.com - addEventListener\n        </A>\n        <A\n          href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\"\n          target=\"_blank\"\n        >\n          MDN - addEventListener\n        </A>\n        <A\n          href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\"\n          target=\"_blank\"\n        >\n          MDN - dispatchEvent\n        </A>\n        <A\n          href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener\"\n          target=\"_blank\"\n        >\n          MDN - removeEventListener\n        </A>\n        <A\n          href=\"https://developer.mozilla.org/en-US/docs/Web/API/Event/stopImmediatePropagation\"\n          target=\"_blank\"\n        >\n          MDN - stopImmediatePropagation\n        </A>\n      </References>\n    </div>\n  )\n}\n","import styled from \"styled-components\"\n\nexport default styled.ul`\n  padding: 10px;\n`\n"],"sourceRoot":""}